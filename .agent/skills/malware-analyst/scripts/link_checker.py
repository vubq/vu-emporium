import re
import sys
import argparse
import urllib.parse

def is_suspicious_url(url):
    print(f"üîç Analyzing URL: {url}")
    
    # Check for basic suspicious patterns
    suspicious_indicators = []
    
    # 1. Check for IP address instead of domain
    ip_pattern = r'^https?://(?:\d{1,3}\.){3}\d{1,3}'
    if re.match(ip_pattern, url):
        suspicious_indicators.append("Contains IP address instead of domain")
    
    # 2. Check for port in URL
    parsed = urllib.parse.urlparse(url)
    if parsed.port and parsed.port not in [80, 443]:
        suspicious_indicators.append(f"Non-standard port: {parsed.port}")
    
    # 3. Check for at-sign (used for obfuscating credentials)
    if "@" in parsed.netloc:
        suspicious_indicators.append("Contains @ symbol (user:pass obfuscation)")
        
    # 4. Check for length (Phishing URLs are often very long)
    if len(url) > 100:
        suspicious_indicators.append("URL length is unusually long (>100 chars)")

    # 5. Check for common phishing keywords
    phishing_keywords = ['login', 'signin', 'verify', 'account', 'secure', 'bank', 'update', 'password']
    for kw in phishing_keywords:
        if kw in url.lower() and parsed.netloc and kw not in parsed.netloc:
            suspicious_indicators.append(f"Contains phishing keyword: '{kw}'")

    if suspicious_indicators:
        print("\n‚ö†Ô∏è  SUSPICIOUS INDICATORS FOUND:")
        for ind in suspicious_indicators:
            print(f"   - {ind}")
        return True
    
    print("\n‚úÖ URL seems clean based on basic pattern analysis.")
    return False

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Antigravity Link Checker")
    parser.add_argument("--url", help="URL to scan")
    args = parser.parse_args()
    
    if args.url:
        result = is_suspicious_url(args.url)
        sys.exit(1 if result else 0)
    else:
        print("Usage: python link_checker.py --url <URL>")
        sys.exit(0)
